<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4times6 Mono Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* 1. 폰트 패밀리 정의 */
        @font-face {
            font-family: 'MonoThin';
            src: url('4times6mono-Thin-COLR.ttf') format('truetype');
        }
        @font-face {
            font-family: 'MonoRegular';
            src: url('4times6mono-Regular-COLR.ttf') format('truetype');
        }
        @font-face {
            font-family: 'MonoBold';
            src: url('4times6mono-Bold-SVG.ttf') format('truetype');
        }
        /* 컬러 폰트 설정 */
        @font-face {
            font-family: 'MonoColor';
            src: url('4times6mono-COLOR-SVG.ttf') format('truetype');
        }

        /* 2. 전체 스타일 */
        body {
            background-color: white;
            color: black;
            font-family: 'MonoRegular', sans-serif;
            overflow: hidden;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* 3. 에디터 영역 */
        #editor {
            flex-grow: 1;
            width: 100%;
            padding: 40px;
            box-sizing: border-box;
            outline: none;
            font-size: 40px; /* 기본 크기 */
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-y: auto;
            
            /* 초기 폰트: Regular */
            font-family: 'MonoRegular';
            
            /* [중요] 컬러 폰트가 흑백으로 나올 때 강제 활성화 시도 */
            font-feature-settings: "calt" 1, "liga" 1, "clig" 1; 
            font-variant-ligatures: common-ligatures;
        }

        /* 플레이스홀더 (불투명도 없이 완전 검정) */
        #editor:empty:before {
            content: 'try typing 4times6 mono';
            color: black; /* 완전 검정 */
            opacity: 1;   /* 투명도 없음 */
            pointer-events: none;
        }

        /* 4. 하단 플로팅 컨트롤 박스 */
        .control-box {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            
            width: 300px;
            background-color: white;
            padding: 20px;
            
            /* 네 변의 색이 다른 2pt 테두리 */
            border-top: 2px solid #FF623E;
            border-right: 2px solid #3C8E77;
            border-bottom: 2px solid #AE62B7;
            border-left: 2px solid #746832;
            
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 100;
        }

        /* 현재 단계 표시 텍스트 (항상 Color 폰트로 표시) */
        #font-label {
            font-family: 'MonoColor', sans-serif; /* 라벨은 무조건 컬러 폰트 */
            font-size: 24px;
            text-align: center;
            margin-bottom: 5px;
            
            /* 라벨도 컬러 강제 활성화 */
            font-feature-settings: "calt" 1; 
        }

        /* 5. 커스텀 슬라이더 스타일 */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }

        /* 슬라이더 트랙 (바) - 색상: FFA31D */
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            cursor: pointer;
            background: #FFA31D;
            border-radius: 0;
        }

        /* 슬라이더 썸 (버튼) - 동적 색상 변경 */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--thumb-color, #FFFA2D);
            cursor: pointer;
            margin-top: -9px; /* 트랙 중앙 정렬 */
            box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
        }

        /* 파이어폭스 지원 */
        input[type=range]::-moz-range-track {
            width: 100%;
            height: 2px;
            cursor: pointer;
            background: #FFA31D;
        }
        input[type=range]::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border: none;
            border-radius: 50%;
            background: var(--thumb-color, #FFFA2D);
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- 텍스트 에디터 -->
    <div id="editor" contenteditable="true" spellcheck="false"></div>

    <!-- 하단 컨트롤 박스 -->
    <div class="control-box">
        <!-- 현재 폰트 종류 표시 -->
        <div id="font-label">Regular</div>
        
        <!-- 슬라이더 (4단계) -->
        <input type="range" id="font-slider" min="0" max="3" value="1" step="1">
    </div>

    <script>
        const editor = document.getElementById('editor');
        const slider = document.getElementById('font-slider');
        const label = document.getElementById('font-label');
        
        // 단계별 설정값
        const steps = [
            { name: 'Thin',    family: 'MonoThin',    color: '#72AF2D' },
            { name: 'Regular', family: 'MonoRegular', color: '#FFFA2D' },
            { name: 'Bold',    family: 'MonoBold',    color: '#EF3F54' },
            { name: 'Color',   family: 'MonoColor',   color: '#34A5D6' }
        ];

        function updateFont() {
            const index = parseInt(slider.value);
            const currentStep = steps[index];

            // 에디터 폰트 변경
            editor.style.fontFamily = currentStep.family;
            
            // 라벨 텍스트 변경
            label.textContent = currentStep.name;
            
            // 슬라이더 버튼 색상 변경
            slider.style.setProperty('--thumb-color', currentStep.color);
        }

        // 입력 필터링 (한글 등 지원하지 않는 문자는 ♥로 변환)
        function filterInput(e) {
            // 조합 중(한글 입력 중)이면 무시하다가 조합이 끝나면 처리
            if (e.type === 'compositionstart') return;
            
            const selection = window.getSelection();
            if (!selection.rangeCount) return;
            
            const node = selection.focusNode;
            
            // 텍스트 노드인 경우
            if (node.nodeType === 3) {
                const text = node.nodeValue;
                // 허용 범위: 영어, 숫자, 기본 특수문자, 공백
                const regex = /[^a-zA-Z0-9\s`~!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/g;

                if (regex.test(text)) {
                    // 현재 커서 위치 저장
                    const range = selection.getRangeAt(0);
                    const offset = range.startOffset;

                    // 변환 실행 (지원 안 되는 문자 -> ♥)
                    const newText = text.replace(regex, '♥'); // U+2665
                    node.nodeValue = newText;

                    // 커서 위치 복구 시도
                    try {
                        const newRange = document.createRange();
                        // 텍스트 길이가 달라지지 않으므로(1글자->1글자) offset 유지 가능
                        newRange.setStart(node, Math.min(offset, newText.length));
                        newRange.setEnd(node, Math.min(offset, newText.length));
                        selection.removeAllRanges();
                        selection.addRange(newRange);
                    } catch (err) {
                        // pass
                    }
                }
            }
        }

        // 이벤트 리스너
        slider.addEventListener('input', updateFont);
        
        // 입력 이벤트 (한글 입력 처리를 위해 input 이벤트 사용)
        editor.addEventListener('input', filterInput);
        
        // 붙여넣기 시 서식 제거 및 필터링
        editor.addEventListener('paste', (e) => {
            e.preventDefault();
            let text = (e.originalEvent || e).clipboardData.getData('text/plain');
            text = text.replace(/[^a-zA-Z0-9\s`~!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/g, '♥');
            document.execCommand('insertText', false, text);
        });

        // 초기화
        updateFont();
        editor.focus();
    </script>
</body>
</html>
